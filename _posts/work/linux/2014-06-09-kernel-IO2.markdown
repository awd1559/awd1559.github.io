---
layout:     post
title:      "io2"
subtitle:   " \"io2\""
date:       2015-01-29 12:00:00
author:     "awd"
header-img: "img/post-bg-2015.jpg"
tags:
    - linux kernel
---
IO读写


全局变量
struct blk_dev_struct {
	/*
	 * queue_proc has to be atomic
	 */
	request_queue_t		request_queue;   	//请求队列
	queue_proc		*queue;			//函数
	void			*data;
};
struct blk_dev_struct blk_dev[MAX_BLKDEV];


struct request_queue
{
	struct request_list	rq;
	int nr_requests;

	atomic_t nr_sectors;
	struct list_head	queue_head;
	elevator_t		elevator;	

	request_fn_proc		* request_fn;
	wait_queue_head_t	wait_for_requests; 	//tasks 
};


struct hd_struct		//硬盘的信息，用于磁盘初始化与分区检查 
{
	long start_sect;
	long nr_sects;
}

struct gendisk			
{
}
全局变量
struct gendisk *gendisk_head;

device_init
	-blk_dev_init		//初始化request队列， blkdev_request
				//初始化全局请求数组blk_dev
	-sti			//
	-net_dev_init		//


devfs_register_blkdev
	-register_blkdev	//在blkdevs数组中为块设备注册block_device_operations


hd_init
	-blk_init_queue		//初始化一个blk_dev数组中的request_queue
	-add_gendisk		//放入hd_gendisk
	-init_timer		//
	-hd_geninit		//
		-hd_geninit



floppy_init